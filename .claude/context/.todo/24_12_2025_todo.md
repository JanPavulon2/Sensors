# Diuna Frontend Refactor Plan - 2025-12-24

## üéØ Objective
Refactor frontend from mixed structure to **feature-first architecture** for scalability and maintainability.

**Approved Approach:** Feature-first with domain-driven boundaries (Option A)

---

## üìê Final Approved Structure

```
src/
‚îú‚îÄ‚îÄ features/                           # Feature modules (domain-driven)
‚îÇ   ‚îú‚îÄ‚îÄ zones/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/                        # React Query hooks (server state)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ queries.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/                 # Zone UI components
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ card/                   # Card variants
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ZoneCard.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ZoneCardHeader.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ZoneCardStatus.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ editor/                 # Zone editor panels
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ColorControlPanel.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AnimationSelector.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AnimationParametersPanel.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ preview/                # LED previews
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CompactLEDPreview.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FullLEDPreview.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PresetColorGrid.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ZonesList.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ZoneDetailPanel.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts                # Public exports
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/                      # Custom UI hooks
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useZoneNavigation.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stores/                     # Zustand UI state
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ zoneUIStore.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/                      # Component-specific types
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ components.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/                      # Zone-specific utilities
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ colorConversions.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts                    # Feature public API
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ logger/                         # ‚úÖ Log Management Feature
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ queries.ts              # (if HTTP API exists)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Logger.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LogViewer.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LogFilterPanel.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useLoggerWebSocket.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useLogCategories.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stores/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loggerStore.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logFilterStore.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ components.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ tasks/                          # ‚úÖ Task Monitoring Feature
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ queries.ts              # (if HTTP API exists)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TaskMonitor.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TaskCard.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TaskStats.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useTaskWebSocket.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stores/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ taskStore.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ components.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ debug/                          # ‚ö†Ô∏è Debug Utilities (Dev Tools Only)
‚îÇ       ‚îú‚îÄ‚îÄ components/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ StateViewer.tsx
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ TreeNode.tsx
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ       ‚îî‚îÄ‚îÄ index.ts
‚îÇ
‚îú‚îÄ‚îÄ shared/                             # Cross-cutting concerns
‚îÇ   ‚îú‚îÄ‚îÄ api/                            # HTTP client
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ client.ts                   # Axios instance (from services/api.ts)
‚îÇ   ‚îú‚îÄ‚îÄ components/                     # Reusable components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MainLayout.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ leds/                       # Generic LED components
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LedStrip.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Led.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CollectionNavigator.tsx     # (to be extracted)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ hooks/                          # Cross-feature hooks
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useAuth.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useSystem.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ types/                          # Shared type definitions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ domain/                     # Business entities
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ zone.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ animation.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ task.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logger.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/                        # API contracts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ responses.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ common.ts                   # Generic utilities
‚îÇ   ‚îú‚îÄ‚îÄ ui/                             # shadcn/ui components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ button.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ card.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dialog.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dropdown-menu.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ input.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ label.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ slider.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ switch.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tabs.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ utils/                          # Generic utilities
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ formatters.ts
‚îÇ   ‚îî‚îÄ‚îÄ websocket/                      # WebSocket client
‚îÇ       ‚îî‚îÄ‚îÄ client.ts                   # (from services/websocket.ts)
‚îÇ
‚îú‚îÄ‚îÄ pages/                              # Top-level route pages (composition)
‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.tsx                   # Composes: zones
‚îÇ   ‚îú‚îÄ‚îÄ ComponentsPage.tsx
‚îÇ   ‚îú‚îÄ‚îÄ DebugPage.tsx                   # Composes: logger + tasks + debug
‚îÇ   ‚îú‚îÄ‚îÄ SettingsPage.tsx
‚îÇ   ‚îî‚îÄ‚îÄ NotFound.tsx
‚îÇ
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ constants.ts
‚îÇ
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ utils.ts                        # Utility helpers (cn, etc.)
‚îÇ
‚îú‚îÄ‚îÄ future-design/                      # ‚ö†Ô∏è UNTOUCHED - experimental code
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ App.tsx
‚îú‚îÄ‚îÄ main.tsx
‚îî‚îÄ‚îÄ index.css
```

---

## üîÑ Migration Phases

### **Phase 1: Foundation Setup** ‚úÖ NOT STARTED

**Goal:** Create folder structure and shared infrastructure

**Tasks:**
- [ ] Create base folder structure:
  ```bash
  mkdir -p src/features/{zones,logger,tasks,debug}/{api,components,hooks,stores,types,utils}
  mkdir -p src/shared/{api,components,hooks,types,ui,utils,websocket}
  mkdir -p src/shared/types/{domain,api}
  mkdir -p src/shared/components/{layout,leds}
  mkdir -p src/pages
  ```

- [ ] Move shared infrastructure:
  - [ ] `services/api.ts` ‚Üí `shared/api/client.ts`
  - [ ] `services/websocket.ts` ‚Üí `shared/websocket/client.ts`
  - [ ] `components/ui/*` ‚Üí `shared/ui/*`
  - [ ] `components/layout/MainLayout.tsx` ‚Üí `shared/components/layout/MainLayout.tsx`
  - [ ] `components/leds/*` ‚Üí `shared/components/leds/*`

- [ ] Move shared types:
  - [ ] `types/zone.ts` ‚Üí `shared/types/domain/zone.ts`
  - [ ] `types/animation.ts` ‚Üí `shared/types/domain/animation.ts`
  - [ ] `types/task.ts` ‚Üí `shared/types/domain/task.ts`
  - [ ] `types/logger.ts` ‚Üí `shared/types/domain/logger.ts`
  - [ ] `types/api.ts` ‚Üí `shared/types/api/responses.ts`

- [ ] Move shared utilities:
  - [ ] `utils/formatters.ts` ‚Üí `shared/utils/formatters.ts`
  - [ ] `utils/colorConvert.ts` ‚Üí `shared/utils/colorConvert.ts` (if not zone-specific)

- [ ] Move shared hooks:
  - [ ] `hooks/useAuth.ts` ‚Üí `shared/hooks/useAuth.ts`
  - [ ] `hooks/useSystem.ts` ‚Üí `shared/hooks/useSystem.ts`

- [ ] Update path aliases in `tsconfig.json`:
  ```json
  {
    "compilerOptions": {
      "paths": {
        "@/*": ["./src/*"],
        "@/features/*": ["./src/features/*"],
        "@/shared/*": ["./src/shared/*"],
        "@/pages/*": ["./src/pages/*"]
      }
    }
  }
  ```

- [ ] Update `vite.config.ts` if path aliases needed there

**Verification:**
- [ ] All shared files imported correctly
- [ ] No broken imports in existing code
- [ ] Build succeeds: `npm run build`
- [ ] Type check passes: `npm run type-check`

---

### **Phase 2: Zones Feature Migration** ‚úÖ NOT STARTED

**Goal:** Complete zones feature module

**Tasks:**

#### 2.1 API Layer (React Query)
- [ ] Create `features/zones/api/queries.ts`
- [ ] Move from `hooks/useZones.ts`:
  - [ ] `useZonesQuery`
  - [ ] `useZoneQuery`
  - [ ] `useUpdateZoneColorMutation`
  - [ ] `useUpdateZoneBrightnessMutation`
  - [ ] `useResetZoneMutation`
  - [ ] `useToggleZoneMutation`
  - [ ] `useUpdateZoneAnimationMutation`
  - [ ] `useUpdateAnimationParametersMutation`
- [ ] Update imports to use `@/shared/api/client`
- [ ] Update imports to use `@/shared/types/domain/zone`

#### 2.2 Stores (Zustand UI State)
- [ ] Create `features/zones/stores/zoneUIStore.ts`
- [ ] Move from `stores/zoneStore.ts`:
  - [ ] Extract UI-only state: `selectedZoneId`
  - [ ] Remove server state management (now in React Query)
  - [ ] Document: "Server state via React Query, UI state only here"

#### 2.3 Components Organization
- [ ] Create subfolder structure:
  - [ ] `features/zones/components/card/`
  - [ ] `features/zones/components/editor/`
  - [ ] `features/zones/components/preview/`

- [ ] Move card components:
  - [ ] `components/zones/ZoneCard.tsx` ‚Üí `features/zones/components/card/ZoneCard.tsx`
  - [ ] Extract header: `features/zones/components/card/ZoneCardHeader.tsx` (optional)
  - [ ] Extract status: `features/zones/components/card/ZoneCardStatus.tsx` (optional)
  - [ ] Create `features/zones/components/card/index.ts`

- [ ] Move editor components:
  - [ ] `components/zones/ColorControlPanel.tsx` ‚Üí `features/zones/components/editor/ColorControlPanel.tsx`
  - [ ] `components/zones/AnimationSelector.tsx` ‚Üí `features/zones/components/editor/AnimationSelector.tsx`
  - [ ] `components/zones/AnimationParametersPanel.tsx` ‚Üí `features/zones/components/editor/AnimationParametersPanel.tsx`
  - [ ] Create `features/zones/components/editor/index.ts`

- [ ] Move preview components:
  - [ ] `components/zones/CompactLEDPreview.tsx` ‚Üí `features/zones/components/preview/CompactLEDPreview.tsx`
  - [ ] `components/zones/FullLEDPreview.tsx` ‚Üí `features/zones/components/preview/FullLEDPreview.tsx`
  - [ ] `components/zones/PresetColorGrid.tsx` ‚Üí `features/zones/components/preview/PresetColorGrid.tsx`
  - [ ] Create `features/zones/components/preview/index.ts`

- [ ] Move list components:
  - [ ] `components/zones/ZonesList.tsx` ‚Üí `features/zones/components/ZonesList.tsx`
  - [ ] `components/zones/ZoneDetailPanel.tsx` ‚Üí `features/zones/components/ZoneDetailPanel.tsx`

- [ ] Create `features/zones/components/index.ts` with public exports

#### 2.4 Utilities
- [ ] `utils/colorConversions.ts` ‚Üí `features/zones/utils/colorConversions.ts`
- [ ] Create `features/zones/utils/index.ts`

#### 2.5 Types
- [ ] Create `features/zones/types/components.ts` for component prop types
- [ ] Domain types stay in `shared/types/domain/zone.ts`

#### 2.6 Hooks
- [ ] Create custom UI hooks in `features/zones/hooks/`
- [ ] Example: `useZoneNavigation.ts` for next/prev zone logic
- [ ] Create `features/zones/hooks/index.ts`

#### 2.7 Public API
- [ ] Create `features/zones/index.ts` with explicit exports:
  ```ts
  // Components
  export { ZoneCard } from './components/card/ZoneCard';
  export { ZonesList } from './components/ZonesList';
  export { ZoneDetailPanel } from './components/ZoneDetailPanel';

  // API (React Query)
  export * from './api/queries';

  // Stores (Zustand)
  export { useZoneUIStore } from './stores/zoneUIStore';

  // Hooks
  export * from './hooks';
  ```

**Verification:**
- [ ] All zone imports work from `@/features/zones`
- [ ] No circular dependencies (check build warnings)
- [ ] Build succeeds: `npm run build`
- [ ] Type check passes: `npm run type-check`
- [ ] Pages using zones still work: `Dashboard.tsx`

---

### **Phase 3: Logger Feature Migration** ‚úÖ NOT STARTED

**Goal:** Complete logger feature module (reusable log management)

**Tasks:**

#### 3.1 API Layer
- [ ] Create `features/logger/api/queries.ts` (if HTTP API exists)
- [ ] Note: Logger primarily uses WebSocket, HTTP may not be needed

#### 3.2 Stores
- [ ] `stores/loggerStore.ts` ‚Üí `features/logger/stores/loggerStore.ts`
- [ ] `stores/logFilterStore.ts` ‚Üí `features/logger/stores/logFilterStore.ts`

#### 3.3 Components
- [ ] `components/logger/Logger.tsx` ‚Üí `features/logger/components/Logger.tsx`
- [ ] `components/logger/LogViewer.tsx` ‚Üí `features/logger/components/LogViewer.tsx`
- [ ] `components/logger/LogFilterPanel.tsx` ‚Üí `features/logger/components/LogFilterPanel.tsx`
- [ ] Create `features/logger/components/index.ts`

#### 3.4 Hooks
- [ ] `hooks/useLoggerWebSocket.ts` ‚Üí `features/logger/hooks/useLoggerWebSocket.ts`
- [ ] `hooks/useLogCategories.ts` ‚Üí `features/logger/hooks/useLogCategories.ts`
- [ ] Update to use `@/shared/websocket/client`
- [ ] Create `features/logger/hooks/index.ts`

#### 3.5 Types
- [ ] Domain: `types/logger.ts` ‚Üí `shared/types/domain/logger.ts` (already moved in Phase 1)
- [ ] Component types: Create `features/logger/types/components.ts`

#### 3.6 Public API
- [ ] Create `features/logger/index.ts`:
  ```ts
  export { Logger } from './components/Logger';
  export { LogViewer } from './components/LogViewer';
  export * from './hooks';
  export * from './stores/loggerStore';
  ```

**Verification:**
- [ ] Logger components work correctly
- [ ] WebSocket connection maintained
- [ ] Build succeeds
- [ ] Type check passes

---

### **Phase 4: Tasks Feature Migration** ‚úÖ NOT STARTED

**Goal:** Complete tasks feature module (reusable task monitoring)

**Tasks:**

#### 4.1 API Layer
- [ ] Create `features/tasks/api/queries.ts` (if HTTP API exists)

#### 4.2 Stores
- [ ] `stores/taskStore.ts` ‚Üí `features/tasks/stores/taskStore.ts`

#### 4.3 Components
- [ ] `components/debug/TaskMonitor.tsx` ‚Üí `features/tasks/components/TaskMonitor.tsx`
- [ ] `components/debug/TaskCard.tsx` ‚Üí `features/tasks/components/TaskCard.tsx`
- [ ] `components/debug/TaskStats.tsx` ‚Üí `features/tasks/components/TaskStats.tsx`
- [ ] Create `features/tasks/components/index.ts`

#### 4.4 Hooks
- [ ] `hooks/useTaskWebSocket.ts` ‚Üí `features/tasks/hooks/useTaskWebSocket.ts`
- [ ] Update to use `@/shared/websocket/client`
- [ ] Create `features/tasks/hooks/index.ts`

#### 4.5 Types
- [ ] Domain: `types/task.ts` ‚Üí `shared/types/domain/task.ts` (already moved in Phase 1)
- [ ] Component types: Create `features/tasks/types/components.ts`

#### 4.6 Public API
- [ ] Create `features/tasks/index.ts`:
  ```ts
  export { TaskMonitor } from './components/TaskMonitor';
  export { TaskCard } from './components/TaskCard';
  export * from './hooks';
  export * from './stores/taskStore';
  ```

**Verification:**
- [ ] Task monitoring works
- [ ] WebSocket connection maintained
- [ ] Build succeeds
- [ ] Type check passes

---

### **Phase 5: Debug Utilities Migration** ‚úÖ NOT STARTED

**Goal:** Complete debug utilities (dev tools only)

**Tasks:**

#### 5.1 Components
- [ ] `components/debug/StateViewer.tsx` ‚Üí `features/debug/components/StateViewer.tsx`
- [ ] `components/debug/TreeNode.tsx` ‚Üí `features/debug/components/TreeNode.tsx`
- [ ] Create `features/debug/components/index.ts`

#### 5.2 Public API
- [ ] Create `features/debug/index.ts`:
  ```ts
  export { StateViewer } from './components/StateViewer';
  ```

**Verification:**
- [ ] StateViewer displays correctly
- [ ] Build succeeds
- [ ] Type check passes

---

### **Phase 6: Pages Migration** ‚úÖ NOT STARTED

**Goal:** Update pages to use new feature structure (composition pattern)

**Tasks:**

#### 6.1 Update Dashboard.tsx
- [ ] Update imports:
  ```ts
  import { ZonesList } from '@/features/zones';
  import { useZonesQuery } from '@/features/zones';
  ```
- [ ] Verify functionality

#### 6.2 Update DebugPage.tsx
- [ ] Update imports (composition of features):
  ```ts
  import { Logger } from '@/features/logger';
  import { TaskMonitor } from '@/features/tasks';
  import { StateViewer } from '@/features/debug';
  ```
- [ ] Verify all three sections render correctly

#### 6.3 Update ComponentsPage.tsx
- [ ] Update imports as needed

#### 6.4 Update SettingsPage.tsx
- [ ] Update imports as needed

#### 6.5 Update App.tsx
- [ ] Update layout import:
  ```ts
  import { MainLayout } from '@/shared/components/layout/MainLayout';
  ```
- [ ] Verify future-design imports unchanged

**Verification:**
- [ ] All routes work: `/`, `/debug`, `/settings`, `/components`
- [ ] No broken imports
- [ ] Navigation works
- [ ] Build succeeds
- [ ] Type check passes

---

### **Phase 7: Cleanup** ‚úÖ NOT STARTED

**Goal:** Remove old folders and verify migration complete

**Tasks:**

#### 7.1 Delete Old Folders
**ONLY delete after verifying all migrations work!**

- [ ] Delete `components/zones/` (if empty)
- [ ] Delete `components/logger/` (if empty)
- [ ] Delete `components/debug/` (if empty)
- [ ] Delete `components/leds/` (if empty)
- [ ] Delete `components/layout/` (if empty)
- [ ] Delete `components/ui/` (moved to shared/ui)
- [ ] Delete `stores/` directory (moved to features)
- [ ] Delete `services/` directory (moved to shared)
- [ ] Delete `types/` directory (moved to shared)

#### 7.2 Review Remaining Files
- [ ] Check `hooks/` directory:
  - [ ] Only `hooks/index.ts` or `hooks/useAnimations.ts` might remain
  - [ ] Move remaining hooks to appropriate features or shared
  - [ ] Delete `hooks/` if empty

- [ ] Check `utils/` directory:
  - [ ] Verify all utils moved to shared or features
  - [ ] Delete `utils/` if empty

- [ ] Verify `components/` directory empty or deleted

#### 7.3 Update Barrel Exports
- [ ] Review all `index.ts` files for unnecessary barrel exports
- [ ] Keep only public API exports

#### 7.4 Update .gitignore
- [ ] Add any new build artifacts if needed

#### 7.5 Final Verification
```bash
npm run build
npm run type-check
npm run lint
```

- [ ] Build succeeds
- [ ] No TypeScript errors
- [ ] No lint errors
- [ ] No console warnings about circular dependencies

#### 7.6 Test All Features
- [ ] Dashboard page loads
- [ ] Zone cards display correctly
- [ ] Zone editing works (color, brightness, animation)
- [ ] Debug page loads
- [ ] Logger shows logs
- [ ] Task monitor shows tasks
- [ ] State viewer shows state tree
- [ ] WebSocket connections work

**Verification:**
- [ ] No old folders remain (except `future-design`)
- [ ] All imports use new structure
- [ ] Application works end-to-end
- [ ] Performance is acceptable

---

## üìù Import Convention - Explicit Imports (Approved)

### **Chosen Approach: Explicit Imports**

**Pattern:**
```typescript
// ‚úÖ GOOD - Explicit imports (preferred)
import { ZoneCard } from '@/features/zones/components/card/ZoneCard';
import { useZonesQuery } from '@/features/zones/api/queries';
import { useZoneUIStore } from '@/features/zones/stores/zoneUIStore';

// ‚úÖ ACCEPTABLE - Feature-level public API (for external usage)
import { ZoneCard, useZonesQuery } from '@/features/zones';

// ‚ùå AVOID - Deep barrel exports
import { ZoneCard } from '@/features/zones/components';
```

### **When to use `index.ts`:**

1. **Subfolder grouping** (Good):
   ```ts
   // features/zones/components/card/index.ts
   export { ZoneCard } from './ZoneCard';
   export { ZoneCardHeader } from './ZoneCardHeader';
   ```

2. **Feature public API** (Good):
   ```ts
   // features/zones/index.ts
   export { ZoneCard } from './components/card/ZoneCard';
   export * from './api/queries';
   ```

3. **Avoid deep chains** (Bad):
   ```ts
   // ‚ùå DON'T create barrel exports at every level
   // features/zones/components/index.ts - SKIP THIS
   ```

### **Import Guidelines:**

- **Within same feature:** Use relative imports
  ```ts
  // In features/zones/components/ZonesList.tsx
  import { ZoneCard } from './card/ZoneCard';
  ```

- **Cross-feature imports:** Use absolute path aliases
  ```ts
  // In pages/Dashboard.tsx
  import { ZonesList } from '@/features/zones';
  import { Logger } from '@/features/logger';
  ```

- **Shared imports:** Always use `@/shared/`
  ```ts
  import { Button } from '@/shared/ui/button';
  import { api } from '@/shared/api/client';
  ```

### **Path Aliases (verify in tsconfig.json):**
```json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./src/*"],
      "@/features/*": ["./src/features/*"],
      "@/shared/*": ["./src/shared/*"],
      "@/pages/*": ["./src/pages/*"]
    }
  }
}
```

---

## üéì State Management Pattern Documentation

**TO BE DOCUMENTED (Phase 8):**

Create: `.claude/context/development/state-management.md`

### **Topics to Cover:**

#### 1. **React Query vs Zustand - When to Use What**

**React Query (Server State):**
- Fetching data from API
- Caching server responses
- Synchronization with backend
- Optimistic updates
- Automatic refetching

**Zustand (UI State):**
- Selected items (e.g., `selectedZoneId`)
- Modal/drawer open state
- UI preferences (theme, layout)
- Client-side temporary state
- Form state (if not using react-hook-form)

#### 2. **Example: Zones Feature**

**Server State (React Query):**
```ts
// features/zones/api/queries.ts
export const useZonesQuery = () => {
  return useQuery<ZonesResponse>({
    queryKey: ['zones'],
    queryFn: async () => {
      const response = await api.get('/v1/zones');
      return response.data;
    },
  });
};
```

**UI State (Zustand):**
```ts
// features/zones/stores/zoneUIStore.ts
export const useZoneUIStore = create((set) => ({
  selectedZoneId: null,
  setSelectedZone: (id) => set({ selectedZoneId: id }),
}));
```

**Usage in Component:**
```tsx
function ZonesList() {
  // Server state - from React Query
  const { data: zonesData } = useZonesQuery();

  // UI state - from Zustand
  const { selectedZoneId, setSelectedZone } = useZoneUIStore();

  return (
    <div>
      {zonesData?.zones.map(zone => (
        <ZoneCard
          key={zone.id}
          zone={zone}
          isSelected={zone.id === selectedZoneId}
          onSelect={() => setSelectedZone(zone.id)}
        />
      ))}
    </div>
  );
}
```

#### 3. **Best Practices**

‚úÖ **DO:**
- Use React Query for server data (zones, animations, tasks, logs)
- Use Zustand for UI state (selection, modals, preferences)
- Keep stores small and focused
- Co-locate state with features
- Document state ownership in comments

‚ùå **DON'T:**
- Store API responses in Zustand (use React Query cache)
- Duplicate server state across stores
- Mix server and UI state in same store
- Create global "god stores"
- Use Zustand for server synchronization

#### 4. **Optimistic Updates Pattern**

```ts
// Use React Query's onMutate for optimistic updates
export const useUpdateZoneColorMutation = (zoneId: string) => {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: async (data) => {
      const response = await api.put(`/v1/zones/${zoneId}/color`, data);
      return response.data.zone;
    },
    onMutate: async (newColor) => {
      // Cancel outgoing refetches
      await queryClient.cancelQueries({ queryKey: ['zones'] });

      // Snapshot previous value
      const previousZones = queryClient.getQueryData(['zones']);

      // Optimistically update
      queryClient.setQueryData(['zones'], (old) => {
        // Update logic here
      });

      return { previousZones };
    },
    onError: (_err, _vars, context) => {
      // Rollback on error
      queryClient.setQueryData(['zones'], context.previousZones);
    },
  });
};
```

#### 5. **Anti-patterns to Avoid**

‚ùå **Storing API data in Zustand:**
```ts
// DON'T DO THIS
const useZoneStore = create((set) => ({
  zones: [],
  fetchZones: async () => {
    const data = await api.get('/zones');
    set({ zones: data.zones });
  },
}));
```

‚úÖ **Use React Query instead:**
```ts
// DO THIS
const { data } = useZonesQuery();
```

---

### **Documentation Task:**
- [ ] Create `.claude/context/development/state-management.md` (Phase 8)
- [ ] Include examples from zones, logger, tasks features
- [ ] Document when to use each approach
- [ ] Add troubleshooting section
- [ ] Review with user for approval

---

## ‚ö†Ô∏è Important Notes

### **Critical Rules:**
1. **NO COMMITS** without direct user order
2. **Test after each phase** - Don't proceed if build fails
3. **Update imports incrementally** - Fix broken imports immediately
4. **Verify future-design** stays untouched throughout migration
5. **Document any deviation** from this plan
6. **Use git branches** for safety (e.g., `feature/frontend-refactor`)

### **Rollback Strategy:**
- Each phase is independent and can be rolled back
- Commit after each phase: "Phase N: [Description]"
- Keep commit messages descriptive
- Tag important milestones

### **Performance Considerations:**
- Explicit imports improve tree-shaking
- Avoid deep barrel exports (causes bundle bloat)
- Keep feature boundaries clear to enable code-splitting
- Monitor bundle size after migration: `npm run build`

### **Type Safety:**
- Shared domain types in `shared/types/domain/`
- Component-specific types in `features/{feature}/types/`
- API types in `shared/types/api/`
- Never use `any` - fix type errors immediately

### **Testing Strategy:**
- Manual testing after each phase
- Verify all routes work
- Check WebSocket connections
- Test API calls
- Verify state updates

---

## üöÄ Migration Checklist Summary

- [ ] **Phase 1:** Foundation Setup (shared infrastructure)
- [ ] **Phase 2:** Zones Feature Migration
- [ ] **Phase 3:** Logger Feature Migration
- [ ] **Phase 4:** Tasks Feature Migration
- [ ] **Phase 5:** Debug Utilities Migration
- [ ] **Phase 6:** Pages Migration (composition pattern)
- [ ] **Phase 7:** Cleanup (delete old folders)
- [ ] **Phase 8:** State Management Documentation
- [ ] **Final Verification:** End-to-end testing

**Estimated Time:** 4-6 hours (careful, incremental migration)
**Risk Level:** Medium (structural changes, many imports)
**Rollback Difficulty:** Easy (phase-by-phase with git)

---

## üìû Pre-Migration Questions

### **Git Strategy:**
- [ ] Create branch: `feature/frontend-refactor`
- [ ] Commit after each phase
- [ ] User approval before merging to main

### **Execution Timing:**
- [ ] When to start migration?
- [ ] Code freeze period needed?

### **Testing:**
- [ ] Manual testing after each phase
- [ ] Automated tests to run (if any)
- [ ] User acceptance testing

### **State Management Docs:**
- [ ] Priority: High / Medium / Low?
- [ ] Create in Phase 8 or earlier?
- [ ] Level of detail: Examples + best practices

---

## üìã Feature Boundary Decisions (Approved)

| Component | Feature | Rationale |
|-----------|---------|-----------|
| **Logger** | `features/logger/` | Reusable log management, own state/hooks |
| **TaskMonitor** | `features/tasks/` | Reusable task monitoring, own state/hooks |
| **StateViewer** | `features/debug/` | Debug utility only, no independent state |
| **ZoneCard** | `features/zones/` | Zone domain, core feature |
| **LED Components** | `shared/components/leds/` | Reusable across features |

**Approved Approach:** Option A (Separate Features)

---

## üìù Notes

- **future-design folder:** UNTOUCHED - stays as experimental code
- **Import style:** Explicit imports preferred, feature-level public API acceptable
- **State management:** React Query (server) + Zustand (UI)
- **Page composition:** Pages compose features (Dashboard uses zones, logger, tasks)

---

**Document Status:** ‚úÖ Ready for Execution
**Last Updated:** 2025-12-24
**Author:** architecture-expert-sonnet
**Approved By:** User (Option A - Separate Features)
**Execution Status:** Awaiting user command to begin
